<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zlow: Browser Cycling Simulator</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.5/dist/peerjs.min.js"></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="../css/style.css?version=1.0"
    />
    <link rel="stylesheet" href="../css/hud.css" />

    <link rel="stylesheet" href="../css/hud.css" />
    <link rel="stylesheet" href="../css/workoutSummary.css" />

    <link
      rel="icon"
      type="image/svg+xml"
      href="../../resources/favicons/ZlowFavicon.svg"
    />
  </head>
  <body>
    <div id="hud-top">
      <div class="hud-section left">
        <div class="stat-item">
          <span id="time" class="stat-value">00:00</span>
        </div>
      </div>

      <div class="hud-section center">
        <div class="stats-row">
          <div class="stat-item">
            <div class="stat-value-group">
              <span id="speed" class="stat-value">0</span>
              <span class="stat-unit speed-unit">km/h</span>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-value-group">
              <span id="power" class="stat-value">0</span>
              <span class="stat-unit power-unit">W</span>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-value-group">
              <span id="distance" class="stat-value">0.00</span>
              <span class="stat-unit distance-unit">km</span>
            </div>
          </div>
        </div>
      </div>

      <div class="hud-section right">
        <div class="stat-item">
          <div class="stat-value-group">
            <span id="calories" class="stat-value">0</span>
            <span class="stat-unit">kcal</span>
          </div>
        </div>
      </div>
    </div>

    <div id="hud-bottom">
      <div class="control-buttons">
        <button
          id="menu-btn"
          class="hud-btn"
          onclick="window.location.href='./mainMenu.html'"
        >
          Main Menu
        </button>
        <button id="pacer-sync-btn" class="hud-btn">Sync Pacer</button>

        <button id="pause-btn" class="hud-btn">Pause</button>
        <button id="stop-btn" class="hud-btn">Stop</button>
      </div>
    </div>

    <!-- Dev hud - hidden by default -->
    <div id="dev-controls-hud" hidden>
      <span id="pacer">
        <label for="pacer-speed">Pacer:</label>
        <input
          id="pacer-speed"
          type="number"
          min="5"
          max="60"
          value="20"
          step="1"
        />
        <span class="speed-unit">km/h</span>
      </span>

      <span id="weight">
        <label for="rider-weight">Weight:</label>
        <input
          id="rider-weight"
          type="number"
          min="40"
          max="150"
          value="70"
          step="1"
        />
        <span class="weight-unit">kg</span>
      </span>

      <button id="connect-btn">Connect Trainer</button>
      <button id="calories-reset-btn">Reset Calories</button>
    </div>

    <!-- Pause overlay -->
    <div id="pause-overlay" aria-hidden="true">
      <div class="pause-dialog">
        Resuming in <span id="pause-countdown">10</span>…
      </div>
    </div>

    <!-- Workout overlay -->
    <div id="workout-overlay" aria-hidden="true">
      <div class="workout-dialog">
        Starting in <span id="workout-countdown">10</span>…
      </div>
    </div>

    <!-- Generate starting scene -->
    <a-scene id="scene" animation-timeline__1="timeline: #avatarMotion">
      <a-assets id="scene_assets">
        <!-- Add textures used to create the track and grass -->
        <img id="track-texture" src="../../resources/textures/Track.jpeg" />
        <img id="grass-texture" src="../../resources/textures/Grass.jpeg" />

        <!-- Building models -->
        <a-asset-item
          id="house-obj"
          src="../../resources/models/bgmodels/House.glb"
        ></a-asset-item>
        <a-asset-item
          id="tall-building-obj"
          src="../../resources/models/bgmodels/TallBuilding.glb"
        ></a-asset-item>
        <a-asset-item
          id="wide-building-obj"
          src="../../resources/models/bgmodels/WideBuilding.glb"
        ></a-asset-item>

        <!-- Add playermodel assets -->
        <a-asset-item
          id="bikeGLB"
          src="../../resources/models/playermodels/bikeV4.glb"
        ></a-asset-item>
        <a-asset-item
          id="maleGLB"
          src="../../resources/models/playermodels/maleV5.glb"
        ></a-asset-item>
        <a-asset-item
          id="femaleGLB"
          src="../../resources/models/playermodels/femaleV6.glb"
        ></a-asset-item>

        <!-- Add cloud assets -->
        <a-asset-item
          id="cloud1"
          src="../../resources/models/bgmodels/cloud1.glb"
        ></a-asset-item>
        <a-asset-item
          id="cloud2"
          src="../../resources/models/bgmodels/cloud2.glb"
        ></a-asset-item>
        <a-asset-item
          id="cloud3"
          src="../../resources/models/bgmodels/cloud3.glb"
        ></a-asset-item>

        <!-- Add tree assets -->
        <a-asset-item
          id="tree1"
          src="../../resources/models/bgmodels/tree1.glb"
        ></a-asset-item>
        <a-asset-item
          id="tree2"
          src="../../resources/models/bgmodels/tree2.glb"
        ></a-asset-item>
        <a-asset-item
          id="tree3"
          src="../../resources/models/bgmodels/tree3.glb"
        ></a-asset-item>
        <a-asset-item
          id="tree-bush1"
          src="../../resources/models/bgmodels/bush1.glb"
        ></a-asset-item>
      </a-assets>
      <a-sky color="#87ceeb" radius="5000"></a-sky>

      <!-- Checkerboard ground: green and brown tiles, covers the whole visible area -->
      <a-entity id="checkerboard-ground">
        <a-entity id="tiles"></a-entity>
      </a-entity>

      <!-- Get values for scene and tilesEntity before using a module to import constants -->
      <script>
        const scene = document.currentScript.parentElement;
        // Add as a new thing rather than getting the entity??
        const tilesEntity = scene.querySelector("#tiles");
      </script>

      <!-- Buildings, trees, clouds, and path are generated dynamically in scene.js and will not overlap the center column -->
      <!-- Use constants to generate checkerboard tiles for ground dynamically -->
      <script type="module">
        import { constants } from "../js/constants.js";
        for (let z = 0; z < constants.gridDepth; z++) {
          for (let x = 0; x < constants.gridWidth; x++) {
            const color =
              (x + z) % 2 === 0
                ? constants.groundColor1
                : constants.groundColor2;
            const tile = document.createElement("a-entity");
            tile.setAttribute(
              "geometry",
              `primitive: box; width: ${constants.tileSize}; height: ${constants.height}; depth: ${constants.tileSize}`
            );
            //tile.setAttribute('material', `color: ${color}; roughness: ${constants.roughness}; metalness: ${constants.metalness}`);
            tile.setAttribute("material", "src: #grass-texture");
            tile.setAttribute(
              "position",
              `${constants.startX + x * constants.tileSize} 0 ${
                constants.startZ - z * constants.tileSize
              }`
            );
            tilesEntity.appendChild(tile);
          }
        }
      </script>

    <script type="module" src="../js/main.js"></script>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        if (window.initZlowApp) window.initZlowApp();
      });
    </script>
    <script type="module">
      import { NotificationManager } from "../js/notifications.js";
      window.testNotifications = new NotificationManager();
    </script>
  </body>
</html>
