<!DOCTYPE html>
<html lang="en" class="settings">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zlow: Browser Cycling Simulator</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <link rel="stylesheet" href="../hud.css" />
    <link rel="stylesheet" href="../menu.css" />
    <style>
        body {
            background-image: url("images/background.png");
        }
    </style>
    <link rel="icon" type="image/svg+xml" href="/favicons/ZlowFavicon.svg">
</head>
<body>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script type="module" src="../js/menu.js"></script>

    <h1 id="welcome-msg" class="center-item">Welcome to <img src="favicons/ZlowFavicon.svg" alt="Z" width="30" height="30" />low!</h1>

    <button id="start-btn" class="stats-row center-item" onclick="window.location.href='../index.html'">Start</button>

    <div id="menu-settings">
        <span id="pacer" class="hud-btn">
            <label for="pacer-speed">Pacer:</label>
            <input id="pacer-speed"
                   type="number"
                   min="5"
                   max="60"
                   value="20"
                   step="1" />
            <span class="speedUnit">km/h</span>
        </span>

        <span id="weight" class="hud-btn">
            <label for="rider-weight">Weight:</label>
            <input id="rider-weight"
                   type="number"
                   min="40"
                   max="150"
                   value="70"
                   step="1" />
            <span class="weightUnit"> kg</span>
        </span>
        <button id="strava-btn" class="hud-btn" onclick="window.location.href='../strava.html'">Strava Settings</button>
        <span id="unitsSpeed" class="hud-btn">
            <label for="unitsSpeed">Units for speed: </label>
            <select name="unitsSpeed" id="unitInputSpeed">
                <option value="km/h">km/h</option>
                <option value="mph">mph</option>
            </select>
        </span>
        <span id="unitsWeight" class="hud-btn">
            <label for="unitsWeight">Units for weight: </label>
            <select name="unitsWeight" id="unitInputWeight">
                <option value="kg">kg</option>
                <option value="lb">lb</option>
            </select>
        </span>
        <!-- Delete this comment if you want to add alternate options for power input 
        <span id="unitsPower" class="hud-btn">
            <label for="unitsPower">Units for power: </label>
            <select name="unitsPower" id="unitInputPower">
                <option value="W">W</option>
            </select>
        </span>
        -->
        <button id="clear-btn" class="hud-btn" onclick="sessionStorage.clear();">Clear settings</button>
        <button id="testMode" class="hud-btn">Developer Testing Mode</button>
    </div>

    <div id="menu-bottom">
        <div class="control-buttons">
            <button id="connect-btn" class="hud-btn">Connect Trainer</button>
            <button id="settings-btn" class="hud-btn" onclick="jQuery('#menu-settings').fadeToggle(500);">Settings</button>
        </div>
    </div>

    <div id="customize">
        <div class="control-buttons">
            <button id="customize-btn" class="hud-btn" onclick="window.location.href='../playerCustomization.html'">Customize Character</button>
        </div>
    </div>

    <!-- Main Menu Avatar -->
    <a-scene id="mainMenuScene" embedded
             style="width: 300px; height: 600px; background: transparent;">
        <a-entity camera position="0 1.5 3" look-controls="enabled: false"></a-entity>
        <a-assets>
            <a-asset-item id="bikeGLB" src="../resources/playermodels/bikeV4.glb"></a-asset-item>
            <a-asset-item id="maleGLB" src="../resources/playermodels/maleV5.glb"></a-asset-item>
            <a-asset-item id="femaleGLB" src="../resources/playermodels/femaleV6.glb"></a-asset-item>
        </a-assets>
    </a-scene>

    <script type="module">
        import { AvatarCreator } from '../js/avatarCreator.js';

        window.addEventListener('DOMContentLoaded', () => {
            const scene = document.querySelector('#mainMenuScene');
            if (!scene) {
                console.error("Scene not found!");
                return;
            }

            //Create the avatar immediately
            const avatar = new AvatarCreator(
                "menuAvatar",
                { x: 0, y: 0, z: -1 },
                { x: 0, y: 90, z: 0 },
                (avatarInstance) => {
                    avatarInstance.setMenuPosition();
                    avatarInstance.enableMenuRotation();
                    avatarInstance.startRotationLoop();
                }
            );
        });
    </script>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            if (window.initSettings) window.initSettings();
        });
    </script>
</body>
</html>