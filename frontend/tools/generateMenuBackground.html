<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Generate Menu Background</title>
  <style>
    body { margin:0; font-family: system-ui, sans-serif; background:#111; color:#fff; }
    #ui {
      position: fixed; top: 10px; left: 10px; z-index: 10;
      background: rgba(0,0,0,0.65); padding: 10px 12px; border-radius: 10px;
      max-width: 520px;
    }
    #status { margin-top: 8px; font-size: 12px; line-height: 1.35; white-space: pre-wrap; }
    button { font-size: 14px; padding: 8px 10px; }
    canvas { display:block; }
  </style>
</head>
<body>

<div id="ui">
  <button id="downloadBtn">Download Background PNG</button>
  <div id="status">Initializing…</div>
</div>

<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
  }
}
</script>

<script type="module">
import * as THREE from "three";
import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";


const statusEl = document.getElementById("status");
function logStatus(msg) {
  console.log(msg);
  statusEl.textContent += `\n${msg}`;
}
statusEl.textContent = "Starting renderer…";

// IMPORTANT: Adjust this to match where this HTML file lives.
// If this file is at /dev/generateMenuBackground.html and your resources are at /resources/…
// then "../resources/models" is correct.
// If you put it somewhere else, update this.
const MODELS_BASE = "../resources/models"; // <- change if needed

// Render resolution for the exported image
const WIDTH = 1920;
const HEIGHT = 1080;

// --- Renderer ---
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(WIDTH, HEIGHT, false);
renderer.setPixelRatio(1);
document.body.appendChild(renderer.domElement);

// --- Scene ---
const scene = new THREE.Scene();

// “Sky” background baked into the image (not transparent)
scene.background = new THREE.Color(0x7cd1f3);

// --- Camera (matches main menu vibe) ---
const camera = new THREE.PerspectiveCamera(45, WIDTH / HEIGHT, 0.01, 500);
camera.position.set(-3.44, 0.28, 2.51);
camera.rotation.set(
  THREE.MathUtils.degToRad(10),
  THREE.MathUtils.degToRad(-20),
  0
);

// --- Lights ---
scene.add(new THREE.AmbientLight(0xffffff, 0.8));

const dir = new THREE.DirectionalLight(0xffffff, 1.5);
dir.position.set(-2, 5, 3);
scene.add(dir);

const point = new THREE.PointLight(0xffffff, 5.5, 3);
point.position.set(-2, 0, 2);
scene.add(point);

// --- Ground (so you always see something) ---
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(50, 50),
  new THREE.MeshStandardMaterial({ color: 0x2d5016, roughness: 1, metalness: 0 })
);
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

// Render immediately so you do NOT get a black screen
renderer.render(scene, camera);
logStatus("Rendered base sky + ground.");

// --- Model loader (never throws the whole page) ---
const loader = new GLTFLoader();

async function loadGLB(url, { pos, rotDeg, scale }) {
  logStatus(`Loading: ${url}`);
  return new Promise((resolve) => {
    loader.load(
      url,
      (gltf) => {
        const obj = gltf.scene;
        obj.position.set(pos.x, pos.y, pos.z);
        obj.rotation.set(
          THREE.MathUtils.degToRad(rotDeg.x),
          THREE.MathUtils.degToRad(rotDeg.y),
          THREE.MathUtils.degToRad(rotDeg.z)
        );
        obj.scale.set(scale.x, scale.y, scale.z);
        scene.add(obj);
        logStatus(`OK: ${url}`);
        resolve(true);
      },
      undefined,
      (err) => {
        logStatus(`FAILED: ${url}\n  ${err?.message || err}`);
        resolve(false); // do not reject
      }
    );
  });
}

async function loadAll() {
  const bg = `${MODELS_BASE}/bgmodels`;
  const pm = `${MODELS_BASE}/playermodels`;

  await loadGLB(`${bg}/tree1.glb`, {
    pos: { x: -2.5, y: 0.1, z: 2 },
    rotDeg: { x: 0, y: 80, z: 0 },
    scale: { x: 0.8, y: 0.8, z: 0.8 },
  });

  await loadGLB(`${pm}/bikeV4.glb`, {
    pos: { x: -2.65, y: 0, z: 2 },
    rotDeg: { x: 0, y: -10, z: -20 },
    scale: { x: 0.1, y: 0.1, z: 0.1 },
  });

  await loadGLB(`${bg}/bush1.glb`, {
    pos: { x: -3.8, y: 0, z: 2 },
    rotDeg: { x: 0, y: 45, z: 0 },
    scale: { x: 0.3, y: 0.3, z: 0.3 },
  });

  await loadGLB(`${bg}/cloud1.glb`, {
    pos: { x: -8, y: 4, z: -5 },
    rotDeg: { x: 0, y: 0, z: 0 },
    scale: { x: 0.1, y: 0.1, z: 0.1 },
  });

  await loadGLB(`${bg}/cloud2.glb`, {
    pos: { x: -3, y: 8, z: -9 },
    rotDeg: { x: 0, y: 0, z: 0 },
    scale: { x: 0.2, y: 0.2, z: 0.2 },
  });

  await loadGLB(`${bg}/cloud3.glb`, {
    pos: { x: -16, y: 6, z: -10 },
    rotDeg: { x: 0, y: 0, z: 0 },
    scale: { x: 0.3, y: 0.3, z: 0.3 },
  });

  await loadGLB(`${bg}/TallBuilding.glb`, {
    pos: { x: -10, y: 0, z: -20 },
    rotDeg: { x: 0, y: -50, z: 10 },
    scale: { x: 1, y: 1, z: 1 },
  });

  await loadGLB(`${bg}/House.glb`, {
    pos: { x: 50, y: 0, z: -18 },
    rotDeg: { x: 0, y: 180, z: 0 },
    scale: { x: 2, y: 2, z: 2 },
  });

  await loadGLB(`${bg}/WideBuilding.glb`, {
    pos: { x: -16, y: -0.1, z: -28 },
    rotDeg: { x: 0, y: -50, z: 10 },
    scale: { x: 1.2, y: 1.2, z: 1.2 },
  });

  renderer.render(scene, camera);
  logStatus("Rendered final image (after model loads).");
}

loadAll();

// Download button
document.getElementById("downloadBtn").onclick = () => {
  const link = document.createElement("a");
  link.download = "menu-background.png";
  link.href = renderer.domElement.toDataURL("image/png");
  link.click();
  logStatus("Downloaded menu-background.png");
};
</script>

</body>
</html>

