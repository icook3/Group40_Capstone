<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zlow: Browser Cycling Simulator</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css?version=1.0">
  <link rel="icon" type="image/svg+xml" href="/resources/favicons/ZlowFavicon.svg">
</head>
<body>
    <div id="hud">
        <span id="pacer" hidden>
            <label for="pacer-speed">Pacer:</label>
            <input id="pacer-speed" type="number" min="5" max="60" value="20" step="1"> km/h
            <br />
        </span>
        <button id="pacer-sync-btn">Sync to Pacer</button>
        <button id="calories-reset-btn">Reset Calories</button>
        </br></br>
        <button id="connect-btn" hidden>Connect Trainer</button>
        <button id="keyboard-btn" hidden>Keyboard Mode</button>
        <div>Power: <span id="power">0</span> W</div>
        <div>Speed: <span id="speed">0</span> km/h</div>
        <div>Distance: <span id="distance">0.00</span> km</div>
        <div>Time: <span id="time">00:00</span></div>
        <div>Calories: <span id="calories">0</span> kcal</div>
        
        <span id="weight" hidden>
            </br>
            <label for="rider-weight">Weight:</label>
            <input id="rider-weight" type="number" min="40" max="150" value="70" step="1" style="width:50px;"> kg</br>
        </span>
        <button id="strava-btn" disabled>Export to Strava</button>
        <button id="gpx-btn">Download TCX</button>
        <a href="resources/settings.html"><button id="settings-btn"><img src="resources/images/gear.PNG" width="20" height="20" /></button></a>
    </div>

  <!-- Generate starting scene -->
  <a-scene id="scene">
      <a-assets>
          <!-- Add textures used to create the track and grass -->
          <img id="track-texture" src="resources/textures/Track.jpeg" />
          <img id="grass-texture" src="resources/textures/Grass.jpeg" />

          <a-asset-item id="cloud1" src="resources/images/test.glb"></a-asset-item>
      </a-assets>
    <a-sky color="#87ceeb"></a-sky>
    <!-- Checkerboard ground: green and brown tiles, covers the whole visible area -->
    <a-entity id="checkerboard-ground">
      <a-entity id="tiles"></a-entity>
    </a-entity>

    <!-- Get values for scene and tilesEntity before using a module to import constants -->
    <script>
      const scene = document.currentScript.parentElement;
      // Add as a new thing rather than getting the entity??
      const tilesEntity = scene.querySelector('#tiles');
    </script>

    <!-- Buildings, trees, clouds, and path are generated dynamically in scene.js and will not overlap the center column -->
    <!-- Use constants to generate checkerboard tiles for ground dynamically -->
    <script type="module">
      import { constants } from './js/constants.js'
      for (let x = 0; x < constants.gridWidth; x++) {
        for (let z = 0; z < constants.gridDepth; z++) {
          const color = (x + z) % 2 === 0 ? constants.groundColor1 : constants.groundColor2;
          const tile = document.createElement('a-entity');
          tile.setAttribute('geometry', `primitive: box; width: ${constants.tileSize}; height: ${constants.height}; depth: ${constants.tileSize}`);
            //tile.setAttribute('material', `color: ${color}; roughness: ${constants.roughness}; metalness: ${constants.metalness}`);
            tile.setAttribute('material', 'src: #grass-texture');
          tile.setAttribute('position', `${constants.startX + x * constants.tileSize} 0 ${constants.startZ - z * constants.tileSize}`);
          tilesEntity.appendChild(tile);
        }
      }
    </script>

    <a-entity camera look-controls position="0 4.5 5"></a-entity>
  </a-scene>
  <script type="module" src="js/main.js"></script>
  <script>
  window.addEventListener('DOMContentLoaded', () => {
    if (window.initZlowApp) window.initZlowApp();
  });
</script>
</body>
</html>
